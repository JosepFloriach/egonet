<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE struts-config PUBLIC
          "-//Apache Software Foundation//DTD Struts Configuration 1.2//EN"
          "http://jakarta.apache.org/struts/dtds/struts-config_1_2.dtd">

<!--
 * <p>Title: Egocentric Networks Web Client</p>
 * <p>Description: Subject Interview Client</p>
 * <p>Copyright: Copyright (c) 2002 - 2004 </p>
 * <p>Company: Endless Loop Software</p>
 * @author Peter Schoaff
 *
 * $Id: struts-config.xml,v 1.13 2004/05/26 12:35:47 admin Exp $
 -->

<struts-config>

  <!-- ========== Form Definitions =========================== -->

   <form-beans>
      <form-bean name="egoNameForm"
                 type="com.endlessloopsoftware.egonet.web.forms.EgoNameForm">
      </form-bean>

      <form-bean name="tutorialForm"
                 type="com.endlessloopsoftware.egonet.web.forms.TutorialForm">
      </form-bean>

      <form-bean name="egoQuestionForm"
                 type="com.endlessloopsoftware.egonet.web.forms.QuestionListForm">
      </form-bean>

      <form-bean name="alterNameForm"
                 type="com.endlessloopsoftware.egonet.web.forms.AlterNameForm">
      </form-bean>

      <form-bean name="alterQuestionForm"
                 type="com.endlessloopsoftware.egonet.web.forms.QuestionListForm">
      </form-bean>

      <form-bean name="alterPairQuestionForm"
                 type="com.endlessloopsoftware.egonet.web.forms.QuestionListForm">
      </form-bean>
      
      <form-bean name="alterPairAppletForm"
                 type="com.endlessloopsoftware.egonet.web.forms.AppletLinkForm">
      </form-bean>
      
   </form-beans>

  <!-- ========== Global Forwards Definitions =========================== -->

	<global-forwards>
		<forward name="welcome" path="/start.do" />
        
		<forward name="authenticationException" path="/start.do" />
      <forward name="workflowViolation_prepare" path="/start.do" />
      <forward name="workflowViolation_egoname" path="/start.do" />
      <forward name="workflowViolation_egoquestions" path="/start.do" />
      <forward name="workflowViolation_nextalter" path="/start.do" />
      <forward name="workflowViolation_altername" path="/start.do" />
      <forward name="workflowViolation_alterquestions" path="/start.do" />
      <forward name="workflowViolation_alterpairquestions" path="/start.do" />
      <forward name="workflowViolation_correction" path="/start.do" />
	</global-forwards>
    
  <!-- ========== Action Mapping Definitions ============================== -->
   <action-mappings type="com.livinglogic.struts.workflow.WorkflowMapping">

      <!-- Initialize Interview -->
		<action
			path         = "/start"
			type         = "com.endlessloopsoftware.egonet.web.actions.WelcomeAction">
			
				<set-property property="secondaryWorkflow"      value="egoname" />
				<set-property property="endWorkflow"            value="true" />
    				
				<set-property property="secondaryWorkflow"      value="egoquestions" />
            <set-property property="endWorkflow"            value="true" />
    
            <set-property property="secondaryWorkflow"      value="altername" />
            <set-property property="endWorkflow"            value="true" />
    
            <set-property property="secondaryWorkflow"      value="alterquestions" />
            <set-property property="endWorkflow"            value="true" />
    
            <set-property property="secondaryWorkflow"      value="alterpairquestions" />
            <set-property property="endWorkflow"            value="true" />
    
            <set-property property="secondaryWorkflow"      value="nextalter" />
            <set-property property="endWorkflow"            value="true" />

            <set-property property="primaryWorkflow"			value="prepare" />
            <set-property property="newState"          		value="start" />
            <set-property property="nextState"          		value="welcome" />
            
            <forward name="Forward" path="/welcome.do"/>
       </action>
   
		<action
			path         = "/welcome"
         type         = "org.apache.struts.actions.ForwardAction"
         parameter    = "/WEB-INF/web/welcome.jsp">
         
				<set-property property="primaryWorkflow"    	value="prepare" />
            <set-property property="prevState"          	value="start" />
            <set-property property="newState"          	value="welcome" />
       </action>
   
      <!-- Ego Name -->
      <action
         path         = "/egoname"
         forward      = "/WEB-INF/web/ego_name.jsp" >
            <set-property property="secondaryWorkflow"    value="prepare" />
            <set-property property="prevState"            value="welcome" />
   
            <set-property property="secondaryWorkflow"    value="nextalter" />
            <set-property property="newState"             value="display" />
              
            <set-property property="primaryWorkflow"      value="egoname" />
            <set-property property="newState"             value="display" />
            <set-property property="nextState"            value="submit" />
      </action>
   
      <action
         path         = "/egonameSubmit"
         type         = "com.endlessloopsoftware.egonet.web.actions.EgoNameAction"
         name         = "egoNameForm"
         scope        = "request"
         validate     = "true"
         input        = "/egoname.do">
            <set-property property="secondaryWorkflow"    value="egoname" />
            <set-property property="prevState"            value="display" />
            <set-property property="newState"             value="submit" />

            <set-property property="primaryWorkflow"      value="nextalter" />
            <set-property property="prevState"            value="display" />
            <set-property property="newState"             value="submit" />
            <set-property property="nextState"            value="position" />
            <set-property property="nextState"				 value="tutorial" />

				<forward name="Tutorial"				  redirect="true" path="/tutorial.do"/>
            <forward name="Position Forward"   redirect="true" path="/positionforward.do"/>
       </action>

      <!-- Tutorial -->
      <action
         path         = "/tutorial"
         forward      = "/Tutorial.htm" >
            <set-property property="primaryWorkflow"    	 value="nextalter" />
            <set-property property="prevState"            value="submit" />
            <set-property property="newState"					 value="tutorial" />
            <set-property property="nextState"            value="submit" />
      </action>
   
      <action
         path         = "/tutorialSubmit"
         type         = "com.endlessloopsoftware.egonet.web.actions.TutorialAction"
         name         = "tutorialForm"
         scope        = "request"
         validate     = "false"
        input        	 = "/tutorial.do">

            <set-property property="primaryWorkflow"      value="nextalter" />
            <set-property property="prevState"            value="tutorial" />
            <set-property property="newState"             value="submit" />
            <set-property property="nextState"            value="position" />

            <forward name="Position Forward"   redirect="true" path="/positionforward.do"/>
       </action>

      <!-- Ego Questions -->
      <action
         path         = "/egoquestions"
         type         = "org.apache.struts.actions.ForwardAction"
         parameter    = "/WEB-INF/web/ego_questions.jsp">
         
			<set-property property="secondaryWorkflow"   value="nextalter" />
			<set-property property="prevState"           value="position" />
			<set-property property="prevState"           value="submit" />
			<set-property property="newState"            value="display" />

			<set-property property="primaryWorkflow"     value="egoquestions" />
         <set-property property="newState"					value="display" />
         <set-property property="nextState"           value="submit" />
            
       </action>
   
      <action
         path         = "/egoquestionsSubmit"
         type         = "com.endlessloopsoftware.egonet.web.actions.EgoQuestionSubmitAction"
         name         = "egoQuestionForm"
         scope         = "request"
         validate      = "true"
         input        = "/egoquestions.do">
                          
         <set-property property="secondaryWorkflow"		value="egoquestions" />
         <set-property property="prevState"           value="display" />
         <set-property property="newState"            value="submit" />

         <set-property property="primaryWorkflow"     value="nextalter" />
         <set-property property="newState"            value="submit" />
         <set-property property="nextState"           value="select" />
                     
         <forward name="Success" path="/nextalterpage.do"/>
            
       </action>
    
      <!-- Next Alter Page - Controls Flow -->
       <action
           path         = "/nextalterpage"
           type         = "com.endlessloopsoftware.egonet.web.actions.NextAlterAction" >
           
			<set-property property="primaryWorkflow" 	value="nextalter" />
			<set-property property="prevState"    		value="submit" />
			<set-property property="newState"    		value="select" />
			<set-property property="nextState"    		value="position" />
			
			<forward name="Position Forward"   path="/positionforward.do"/>
       </action>

      <!-- Position Forward - Forwards to page stored in InterviewPosition -->
       <action
           path         = "/positionforward"
           type         = "com.endlessloopsoftware.egonet.web.actions.PositionForward" >
           
			<set-property property="primaryWorkflow" 	value="nextalter" />
			<set-property property="prevState"    		value="submit" />
         <set-property property="prevState"    		value="select" />
         <set-property property="newState"    		value="position" />
         <set-property property="nextState"    		value="display" />
         <set-property property="nextState"    		value="complete" />

			<forward name="Ego Questions"          		redirect="true"		path="/egoquestions.do"/>
         <forward name="Alter Prompt"           		redirect="true"   path="/altername.do"/>
         <forward name="Alter Questions"      		redirect="true"   path="/alterquestions.do"/>
         <forward name="Alter Pair Questions" 		redirect="true"   path="/alterpairquestions.do"/>
         <forward name="Alter Pair Applet"       	redirect="true"   path="/alterpairapplet.do"/>
         <forward name="Correction"             		redirect="true"  	path="/correctionapplet.do"/>
         <forward name="Complete"              		redirect="true"   path="/complete.do"/>
            
       </action>

      <!-- Alter Prompt -->
      <action
         path           = "/altername"
         type         	= "org.apache.struts.actions.ForwardAction"
         parameter      = "/alter_prompt.jsp">
         
			<set-property property="secondaryWorkflow"      value="nextalter" />
			<set-property property="prevState"             value="position" />
			<set-property property="prevState"             value="submit" />
			<set-property property="newState"             value="display" />

			<set-property property="primaryWorkflow"       value="altername" />
			<set-property property="newState"             value="display" />
			<set-property property="nextState"             value="submit" />
            
       </action>
   
       <action
           path         = "/alternameSubmit"
           type         = "com.endlessloopsoftware.egonet.web.actions.AlterNameSubmitAction"
           name         = "alterNameForm"
           scope      = "request"
           parameter   = "submit"
           validate   = "true"
           input        = "/altername.do">
           
              <set-property property="secondaryWorkflow"    value="altername" />
               <set-property property="prevState"             value="display" />
            <set-property property="newState"             value="submit" />

            <set-property property="primaryWorkflow"       value="nextalter" />
               <set-property property="prevState"             value="display" />
            <set-property property="newState"             value="submit" />
            
            <forward name="Success"             path="/nextalterpage.do"/>
            
            <!-- On cancel we update alter prompt type and retry question -->
            <forward name="Position Forward"   path="/positionforward.do"/>
       </action>

      <!-- Alter Pair Questions -->
      <action
         path         = "/alterpairquestions"
         type         = "org.apache.struts.actions.ForwardAction"
         parameter      = "/WEB-INF/web/alter_pair_questions.jsp">
         
         <set-property property="secondaryWorkflow"    value="nextalter" />
            <set-property property="prevState"             value="position" />
            <set-property property="prevState"             value="submit" />
         <set-property property="newState"             value="display" />

         <set-property property="primaryWorkflow"       value="alterpairquestions" />
         <set-property property="newState"             value="display" />
         <set-property property="nextState"             value="submit" />
            
       </action>
   
       <action
           path         = "/alterpairquestionsSubmit"
           type         = "com.endlessloopsoftware.egonet.web.actions.AlterPairSubmitAction"
           name         = "alterPairQuestionForm"
           scope      = "request"
           validate   = "true"
           input        = "/alterpairquestions.do">
           
              <set-property property="secondaryWorkflow"    value="alterpairquestions" />
               <set-property property="prevState"             value="display" />
            <set-property property="newState"             value="submit" />

            <set-property property="primaryWorkflow"       value="nextalter" />
               <set-property property="prevState"             value="display" />
            <set-property property="newState"             value="submit" />
            
            <forward name="Success" path="/nextalterpage.do"/>
            
       </action>

      <!-- Alter Pair Applet Linking -->
      <action
         path         = "/alterpairapplet"
         type         = "org.apache.struts.actions.ForwardAction"
         parameter      = "/alter_pair_applet.jsp">
         
              <set-property property="secondaryWorkflow"    value="nextalter" />
               <set-property property="prevState"             value="position" />
            <set-property property="newState"             value="display" />

            <set-property property="primaryWorkflow"       value="alterpairquestions" />
            <set-property property="newState"             value="display" />
            <set-property property="nextState"             value="submit" />
            
       </action>
   
       <action
           path         = "/alterpairappletSubmit"
           type         = "com.endlessloopsoftware.egonet.web.actions.AlterPairAppletAction"
           name         = "alterPairAppletForm"
           scope      = "request"
           validate   = "false"
           input        = "/alterpairapplet.do">
           
              <set-property property="secondaryWorkflow"    value="alterpairquestions" />
               <set-property property="prevState"             value="display" />
            <set-property property="newState"             value="submit" />

            <set-property property="primaryWorkflow"       value="nextalter" />
               <set-property property="prevState"             value="display" />
            <set-property property="newState"             value="submit" />
            
            <forward name="Success" path="/nextalterpage.do"/>
            
       </action>

      <!-- Correct Applet Linking -->
      <action
         path         = "/correctionapplet"
         type         = "org.apache.struts.actions.ForwardAction"
         parameter      = "/correction_applet.jsp">
         
			<set-property property="secondaryWorkflow"    value="nextalter" />
			<set-property property="prevState"             value="position" />
			<set-property property="newState"             value="display" />

			<set-property property="primaryWorkflow"       value="correction" />
			<set-property property="newState"             value="display" />
			<set-property property="nextState"             value="submit" />
            
       </action>
   
       <action
           path         = "/correctionappletSubmit"
           type         = "com.endlessloopsoftware.egonet.web.actions.AlterPairAppletAction"
           name         = "alterPairAppletForm"
           scope      = "request"
           validate   = "false"
           input        = "/correctionapplet.do">
           
			<set-property property="secondaryWorkflow"    value="correction" />
			<set-property property="prevState"             value="display" />
			<set-property property="newState"             value="submit" />

			<set-property property="primaryWorkflow"       value="nextalter" />
               <set-property property="prevState"             value="display" />
            <set-property property="newState"             value="submit" />
            
            <forward name="Success" path="/nextalterpage.do"/>
            
       </action>

      <!-- Alter Questions -->
      <action
         path         = "/alterquestions"
         type         = "org.apache.struts.actions.ForwardAction"
         parameter      = "/alter_questions_applet.jsp">
         
              <set-property property="secondaryWorkflow"    value="nextalter" />
               <set-property property="prevState"             value="submit" />
               <set-property property="prevState"             value="position" />
            <set-property property="newState"             value="display" />

            <set-property property="primaryWorkflow"       value="alterquestions" />
            <set-property property="newState"             value="display" />
            <set-property property="nextState"             value="submit" />
            
       </action>
   
       <action
           path         = "/alterquestionsSubmit"
           type         = "com.endlessloopsoftware.egonet.web.actions.AlterQuestionsSubmitAction"
           name         = "alterQuestionForm"
           scope      = "request"
           validate   = "true"
           input        = "/alterquestions.do">
           
              <set-property property="secondaryWorkflow"    value="alterquestions" />
               <set-property property="prevState"             value="display" />
            <set-property property="newState"             value="submit" />

            <set-property property="primaryWorkflow"       value="nextalter" />
            <set-property property="newState"             value="submit" />
            
            <forward name="Success" path="/nextalterpage.do"/>
            
       </action>

       <!-- Survey is completed -->
      <action
         path         	= "/complete"
         type         	= "org.apache.struts.actions.ForwardAction"
         parameter		= "/complete.jsp">
         
            <set-property property="secondaryWorkflow"       value="prepare" />
            <set-property property="endWorkflow"             value="true" />
 
            <set-property property="secondaryWorkflow"       value="egoname" />
           	<set-property property="endWorkflow"             value="true" />
 
            <set-property property="secondaryWorkflow"       value="egoquestions" />
           	<set-property property="endWorkflow"             value="true" />
 
            <set-property property="secondaryWorkflow"       value="altername" />
           	<set-property property="endWorkflow"             value="true" />
 
            <set-property property="secondaryWorkflow"       value="alterquestions" />
           	<set-property property="endWorkflow"             value="true" />
 
            <set-property property="secondaryWorkflow"       value="alterpairquestions" />
           	<set-property property="endWorkflow"             value="true" />
 
            <set-property property="secondaryWorkflow"       value="correction" />
           	<set-property property="endWorkflow"             value="true" />
 
           	<set-property property="primaryWorkflow"          value="nextalter" />
            <set-property property="prevState"                value="position" />
         	<set-property property="newState"                value="complete" />
           	<set-property property="endWorkflow"             value="true" />
         </action>

   </action-mappings>

   <!-- ========== Controller Configuration =============================== -->
     <controller 
      processorClass="com.livinglogic.struts.workflow.WorkflowRequestProcessor" />

   <!-- ========== Message Resources Definitions =========================== -->

   <message-resources parameter="com.endlessloopsoftware.egonet.web.resources.ApplicationResources"/>

   <!-- ========== Plug-in Definitions =========================== -->

   <plug-in className="org.apache.struts.validator.ValidatorPlugIn">
      <set-property 
         property="pathnames" 
         value="/WEB-INF/validator-rules.xml, /WEB-INF/validation.xml"/>
   </plug-in>

 </struts-config>
 
