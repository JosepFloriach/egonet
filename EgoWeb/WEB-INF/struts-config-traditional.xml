<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE struts-config PUBLIC
          "-//Apache Software Foundation//DTD Struts Configuration 1.2//EN"
          "http://jakarta.apache.org/struts/dtds/struts-config_1_2.dtd">

<!--
 * <p>Title: Egocentric Networks Web Client</p>
 * <p>Description: Subject Interview Client</p>
 * <p>Copyright: Copyright (c) 2002 - 2004 </p>
 * <p>Company: Endless Loop Software</p>
 * @author Peter Schoaff
 *
 * $Id: struts-config-traditional.xml,v 1.1 2004/04/05 01:17:44 admin Exp $
 -->

<struts-config>

  <!-- ========== Form Definitions =========================== -->

	<form-beans>
		<form-bean name="egoNameForm"
		           type="com.endlessloopsoftware.egonet.web.forms.EgoNameForm">
		</form-bean>

		<form-bean name="egoQuestionForm"
		           type="com.endlessloopsoftware.egonet.web.forms.QuestionListForm">
		</form-bean>

		<form-bean name="alterNameForm"
		           type="com.endlessloopsoftware.egonet.web.forms.AlterNameForm">
		</form-bean>

		<form-bean name="alterQuestionForm"
		           type="com.endlessloopsoftware.egonet.web.forms.QuestionListForm">
		</form-bean>

		<form-bean name="alterPairQuestionForm"
		           type="com.endlessloopsoftware.egonet.web.forms.QuestionListForm">
		</form-bean>
	</form-beans>

  <!-- ========== Global Forwards Definitions =========================== -->

    <global-forwards>
        <forward name="welcome" path="/start.do" />
        
		<forward name="authenticationException" path="/start.do" />
		<forward name="workflowViolation_prepare" path="/start.do" />
		<forward name="workflowViolation_egoname" path="/start.do" />
		<forward name="workflowViolation_egoquestions" path="/start.do" />
 		<forward name="workflowViolation_nextalter" path="/start.do" />
 		<forward name="workflowViolation_altername" path="/start.do" />
 		<forward name="workflowViolation_alterquestions" path="/start.do" />
 		<forward name="workflowViolation_alterpairquestions" path="/start.do" />
    </global-forwards>
    
  <!-- ========== Action Mapping Definitions ============================== -->
	<action-mappings type="com.livinglogic.struts.workflow.WorkflowMapping">

	   <!-- Initialize Interview -->
		<action
			path			= "/start"
			type				= "com.endlessloopsoftware.egonet.web.actions.WelcomeAction">
  				<set-property property="primaryWorkflow" value="prepare" />
				<set-property property="newState" value="start" />
				<set-property property="nextState" value="welcome" />
				<forward name="Forward" path="/welcome.do"/>
	    </action>
	
	   <action
	        path			= "/welcome"
			type				= "org.apache.struts.actions.ForwardAction"
			parameter		= "/WEB-INF/web/welcome.jsp">
  				<set-property property="primaryWorkflow" value="prepare" />
				<set-property property="prevState" value="start" />
				<set-property property="newState" value="welcome" />
	    </action>
	
		<!-- Ego Name -->
		<action
			path			= "/egoname"
			forward		= "/WEB-INF/web/ego_name.jsp" >
				<set-property property="secondaryWorkflow" value="prepare" />
				<set-property property="prevState" value="welcome" />
	
				<set-property property="primaryWorkflow" value="egoname" />
				<set-property property="newState" value="display" />
				<set-property property="nextState" value="submit" />
		</action>
	
		<action
			path			= "/egonameSubmit"
			type			= "com.endlessloopsoftware.egonet.web.actions.EgoNameAction"
			name			= "egoNameForm"
			scope			= "request"
			validate		= "true"
			input     	= "/egoname.do">
				<set-property property="secondaryWorkflow" value="egoname" />
				<set-property property="prevState"         value="display" />
				<set-property property="newState"          value="submit" />

     			<set-property property="primaryWorkflow" value="nextalter" />
				<set-property property="newState"        value="select" />
				<set-property property="nextState"       value="display" />
				<set-property property="nextState"       value="complete" />

				<forward name="Ego Questions"				path="/egoquestions.do"/>
				<forward name="Alter Prompt" 			 	path="/altername.do"/>
				<forward name="Alter Questions"      	path="/alterquestions.do"/>
				<forward name="Alter Pair Questions" 	path="/alterpairquestions.do"/>
				<forward name="Complete" 				 	path="/complete.do"/>
		 </action>

		<!-- Ego Questions -->
		<action
			path			= "/egoquestions"
			type			= "org.apache.struts.actions.ForwardAction"
			parameter	= "/WEB-INF/web/ego_questions.jsp">
			
   			<set-property property="secondaryWorkflow" value="egoname" />
   			<set-property property="prevState" value="submit" />

   			<set-property property="secondaryWorkflow" value="nextalter" />
   			<set-property property="prevState" value="select" />
   			<set-property property="newState" value="display" />

  				<set-property property="primaryWorkflow" value="egoquestions" />
				<set-property property="newState" value="display" />
				<set-property property="nextState" value="submit" />
				
	    </action>
	
		<action
			path			= "/egoquestionsSubmit"
			type			= "com.endlessloopsoftware.egonet.web.actions.EgoQuestionSubmitAction"
			name			= "egoQuestionForm"
			scope			= "request"
			validate		= "true"
			input     	= "/egoquestions.do">
	        
				<set-property property="secondaryWorkflow" value="nextalter" />
				<set-property property="newState" value="submit" />
					
				<set-property property="primaryWorkflow" value="egoquestions" />
				<set-property property="prevState" value="display" />
				<set-property property="newState" value="submit" />
								
				<forward name="Success" path="/nextalterpage.do"/>
				
	    </action>
	 
		<!-- Next Alter Page - Controls Flow -->
	    <action
	        path			= "/nextalterpage"
	        type			= "com.endlessloopsoftware.egonet.web.actions.NextAlterAction" >
	        
     			<set-property property="primaryWorkflow" value="nextalter" />
   			<set-property property="prevState" value="submit" />
   			<set-property property="newState" value="select" />
   			<set-property property="nextState" value="display" />
				<set-property property="nextState" value="complete" />

				<forward name="Alter Prompt" 			 path="/altername.do"/>
				<forward name="Alter Questions"      path="/alterquestions.do"/>
				<forward name="Alter Pair Questions" path="/alterpairquestions.do"/>
				<forward name="Complete" 				 path="/complete.do"/>
				
	    </action>

		<!-- Alter Prompt -->
	   <action
	      path  			= "/altername"
			type				= "org.apache.struts.actions.ForwardAction"
			parameter		= "/alter_prompt.jsp">
			
  				<set-property property="secondaryWorkflow" value="nextalter" />
   			<set-property property="prevState" value="select" />
   			<set-property property="prevState" value="submit" />
				<set-property property="newState" value="display" />

				<set-property property="primaryWorkflow" value="altername" />
				<set-property property="newState" value="display" />
				<set-property property="nextState" value="submit" />
				
	    </action>
	
	    <action
	        path			= "/alternameSubmit"
	        type			= "com.endlessloopsoftware.egonet.web.actions.AlterNameSubmitAction"
	        name			= "alterNameForm"
	        scope			= "request"
	        validate		= "true"
	        input     	= "/altername.do">
	        
  				<set-property property="secondaryWorkflow" value="altername" />
   			<set-property property="prevState" value="display" />
				<set-property property="newState" value="submit" />

				<set-property property="primaryWorkflow" value="nextalter" />
				<set-property property="newState" value="submit" />
				
				<forward name="Success" path="/nextalterpage.do"/>
	    </action>

		<!-- Alter Questions -->
	   <action
	      path			   = "/alterquestions"
			type				= "org.apache.struts.actions.ForwardAction"
			parameter		= "/WEB-INF/web/alter_questions.jsp">
			
  				<set-property property="secondaryWorkflow" value="nextalter" />
   			<set-property property="prevState" value="select" />
				<set-property property="newState" value="display" />

				<set-property property="primaryWorkflow" value="alterquestions" />
				<set-property property="newState" value="display" />
				<set-property property="nextState" value="submit" />
				
	    </action>
	
	    <action
	        path			= "/alterquestionsSubmit"
	        type			= "com.endlessloopsoftware.egonet.web.actions.AlterQuestionsSubmitAction"
	        name			= "alterQuestionForm"
	        scope			= "request"
	        validate		= "true"
	        input     	= "/WEB-INF/web/alterquestions.do">
	        
  				<set-property property="secondaryWorkflow" value="alterquestions" />
   			<set-property property="prevState" value="display" />
				<set-property property="newState" value="submit" />

				<set-property property="primaryWorkflow" value="nextalter" />
				<set-property property="newState" value="submit" />
				
				<forward name="Success" path="/nextalterpage.do"/>
				
	    </action>

		<!-- Alter Pair Questions -->
	   <action
			path			   = "/alterpairquestions"
			type				= "org.apache.struts.actions.ForwardAction"
			parameter		= "/WEB-INF/web/alter_pair_questions.jsp">
			
  				<set-property property="secondaryWorkflow" value="nextalter" />
   			<set-property property="prevState" value="select" />
				<set-property property="newState" value="display" />

				<set-property property="primaryWorkflow" value="alterpairquestions" />
				<set-property property="newState" value="display" />
				<set-property property="nextState" value="submit" />
				
	    </action>
	
	    <action
	        path			= "/alterpairquestionsSubmit"
	        type			= "com.endlessloopsoftware.egonet.web.actions.AlterPairSubmitAction"
	        name			= "alterPairQuestionForm"
	        scope			= "request"
	        validate		= "true"
	        input     	= "/alterpairquestions.do">
	        
  				<set-property property="secondaryWorkflow" value="alterpairquestions" />
   			<set-property property="prevState" value="display" />
				<set-property property="newState" value="submit" />

				<set-property property="primaryWorkflow" value="nextalter" />
				<set-property property="newState" value="submit" />
				
				<forward name="Success" path="/nextalterpage.do"/>
				
	    </action>

	    <!-- Survey is completed -->
		<action
			path			   = "/complete"
			type				= "org.apache.struts.actions.ForwardAction"
			parameter		= "/complete.jsp">
			
   			<set-property property="secondaryWorkflow" value="prepare" />
   			<set-property property="endWorkflow" value="true" />
 
   			<set-property property="secondaryWorkflow" value="egoname" />
  				<set-property property="endWorkflow" value="true" />
 
   			<set-property property="secondaryWorkflow" value="egoquestions" />
  				<set-property property="endWorkflow" value="true" />
 
   			<set-property property="secondaryWorkflow" value="altername" />
  				<set-property property="endWorkflow" value="true" />
 
   			<set-property property="secondaryWorkflow" value="alterquestions" />
  				<set-property property="endWorkflow" value="true" />
 
   			<set-property property="secondaryWorkflow" value="alterpairquestions" />
  				<set-property property="endWorkflow" value="true" />
 
  			<set-property property="primaryWorkflow" value="nextalter" />
   			<set-property property="prevState" value="select" />
			<set-property property="newState" value="complete" />
  			<set-property property="endWorkflow" value="true" />
  	    </action>

	</action-mappings>

	<!-- ========== Controller Configuration =============================== -->
  	<controller 
		processorClass="com.livinglogic.struts.workflow.WorkflowRequestProcessor" />

	<!-- ========== Message Resources Definitions =========================== -->

	<message-resources parameter="com.endlessloopsoftware.egonet.web.resources.ApplicationResources"/>

	<!-- ========== Plug-in Definitions =========================== -->

	<plug-in className="org.apache.struts.validator.ValidatorPlugIn">
		<set-property 
			property="pathnames" 
			value="/WEB-INF/validator-rules.xml, /WEB-INF/validation.xml"/>
	</plug-in>

 </struts-config>
 
